<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>üê¢ Turtok Mission Control</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    :root {
      --bg: #090b11;
      --bg-soft: #0f1320;
      --panel: rgba(13, 18, 33, 0.7);
      --panel-strong: rgba(17, 23, 42, 0.9);
      --border: rgba(255, 255, 255, 0.12);
      --border-soft: rgba(255, 255, 255, 0.08);
      --text: #f8faff;
      --text-2: rgba(240, 245, 255, 0.72);
      --text-3: rgba(240, 245, 255, 0.45);
      --accent: #7c8bff;
      --accent-2: #56d6ff;
      --green: #34d399;
      --amber: #fbbf24;
      --red: #fb7185;
      --blue: #60a5fa;
      --radius: 16px;
      --radius-sm: 12px;
      --card-shadow: 0 10px 30px rgba(3, 7, 18, 0.5), 0 2px 10px rgba(3, 7, 18, 0.35);
      --lift-shadow: 0 18px 40px rgba(2, 6, 23, 0.55), 0 6px 16px rgba(2, 6, 23, 0.45);
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1100px circle at 8% -10%, rgba(124,139,255,0.16), transparent 60%),
        radial-gradient(800px circle at 92% 6%, rgba(86,214,255,0.12), transparent 58%),
        radial-gradient(900px circle at 50% 120%, rgba(52,211,153,0.08), transparent 58%),
        var(--bg);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    .ambient { position: fixed; inset: 0; pointer-events: none; z-index: 0; overflow: hidden; }
    .blob { position: absolute; border-radius: 999px; filter: blur(130px); animation: drift 22s ease-in-out infinite; }
    .b1 { width: 560px; height: 560px; background: rgba(124,139,255,0.16); top: -220px; left: -120px; }
    .b2 { width: 480px; height: 480px; background: rgba(86,214,255,0.14); right: -120px; top: 18%; animation-delay: -7s; }
    .b3 { width: 560px; height: 560px; background: rgba(52,211,153,0.08); bottom: -260px; left: 42%; animation-delay: -14s; }

    @keyframes drift {
      0%, 100% { transform: translate3d(0,0,0) scale(1); }
      33% { transform: translate3d(26px,-16px,0) scale(1.03); }
      66% { transform: translate3d(-20px,10px,0) scale(0.98); }
    }

    .container {
      max-width: 1500px;
      margin: 0 auto;
      padding: 28px 24px 34px;
      position: relative;
      z-index: 1;
    }

    .glass {
      background: linear-gradient(145deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));
      backdrop-filter: blur(24px) saturate(1.35);
      -webkit-backdrop-filter: blur(24px) saturate(1.35);
      border: 1px solid var(--border-soft);
      border-radius: var(--radius);
      box-shadow: var(--card-shadow);
      position: relative;
      overflow: hidden;
    }

    .glass::before {
      content: '';
      position: absolute;
      inset: 0;
      border-radius: inherit;
      pointer-events: none;
      border: 1px solid rgba(255,255,255,0.06);
      mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
      mask-composite: exclude;
      padding: 1px;
    }

    .glass-sm { border-radius: var(--radius-sm); }

    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
      padding: 14px 16px;
      border: 1px solid var(--border-soft);
      background: rgba(12, 16, 28, 0.62);
      border-radius: 18px;
      backdrop-filter: blur(20px);
      box-shadow: var(--card-shadow);
    }

    .h-left { display: flex; align-items: center; gap: 14px; }
    .h-icon {
      width: 42px;
      height: 42px;
      border-radius: 12px;
      display: grid;
      place-items: center;
      font-size: 23px;
      background: linear-gradient(135deg, rgba(124,139,255,.28), rgba(86,214,255,.24));
      border: 1px solid rgba(255,255,255,0.15);
    }
    .h-title { font-size: 21px; font-weight: 700; letter-spacing: -0.5px; }
    .h-sub { font-size: 10px; color: var(--text-3); letter-spacing: 1.5px; text-transform: uppercase; margin-top: 3px; }

    .h-right { display: flex; align-items: center; gap: 10px; }
    .clock {
      font-size: 11px;
      color: var(--text-3);
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      background: rgba(255,255,255,0.03);
      border: 1px solid var(--border-soft);
      border-radius: 10px;
      padding: 8px 10px;
    }
    .status-pill {
      display: flex;
      align-items: center;
      gap: 7px;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: .7px;
      text-transform: uppercase;
      color: var(--green);
      padding: 8px 12px;
      border-radius: 999px;
      background: rgba(52,211,153,0.12);
      border: 1px solid rgba(52,211,153,0.32);
    }
    .s-dot { width: 6px; height: 6px; border-radius: 50%; background: var(--green); animation: pulse 1.9s ease-in-out infinite; }
    @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:.35;transform:scale(.9)} }

    .btn {
      border: 1px solid rgba(255,255,255,0.16);
      border-radius: 12px;
      background: linear-gradient(165deg, rgba(255,255,255,0.14), rgba(255,255,255,0.02));
      color: var(--text);
      font-size: 12px;
      font-weight: 600;
      padding: 9px 13px;
      cursor: pointer;
      transition: all .22s ease;
      box-shadow: 0 6px 18px rgba(3,7,18,.35);
    }
    .btn:hover {
      transform: translateY(-1px);
      border-color: rgba(124,139,255,.45);
      box-shadow: 0 12px 22px rgba(3,7,18,.45), 0 0 0 1px rgba(124,139,255,.2) inset;
    }

    .cur {
      padding: 14px 18px;
      margin-bottom: 20px;
      display: flex;
      align-items: center;
      gap: 12px;
      border-color: rgba(124,139,255,.28);
      box-shadow: var(--card-shadow), 0 0 0 1px rgba(124,139,255,.18) inset, 0 14px 35px rgba(124,139,255,.14);
    }
    .cur-label { font-size: 10px; font-weight: 800; text-transform: uppercase; letter-spacing: 1.4px; color: var(--accent-2); }
    .cur-text { font-size: 13px; font-weight: 500; color: var(--text-2); }

    .stats { display: grid; grid-template-columns: repeat(5,1fr); gap: 12px; margin-bottom: 20px; }
    .stat {
      padding: 18px 16px;
      text-align: center;
      transition: all .2s ease;
      background: linear-gradient(165deg, rgba(255,255,255,0.08), rgba(255,255,255,0.03));
      border-color: rgba(255,255,255,.12);
    }
    .stat:hover { transform: translateY(-2px); box-shadow: var(--lift-shadow); }
    .sv { font-size: 30px; font-weight: 800; letter-spacing: -.9px; line-height: 1; }
    .sl { font-size: 10px; color: var(--text-3); text-transform: uppercase; letter-spacing: 1.2px; margin-top: 6px; }

    .prog { margin-bottom: 24px; }
    .prog-h { display:flex; justify-content:space-between; font-size:11px; color:var(--text-3); margin-bottom:8px; }
    .prog-track {
      height: 8px;
      background: rgba(255,255,255,0.08);
      border-radius: 999px;
      overflow: hidden;
      border: 1px solid rgba(255,255,255,0.06);
      box-shadow: inset 0 1px 3px rgba(0,0,0,.4);
    }
    .prog-fill {
      height: 100%;
      border-radius: 999px;
      background: linear-gradient(90deg, var(--accent), var(--accent-2), var(--green));
      box-shadow: 0 0 24px rgba(86,214,255,.45);
      transition: width .8s cubic-bezier(.4,0,.2,1);
    }

    .tabs {
      display: inline-flex;
      gap: 6px;
      padding: 6px;
      margin-bottom: 20px;
      border-radius: 14px;
      background: rgba(255,255,255,0.04);
      border: 1px solid var(--border-soft);
      box-shadow: var(--card-shadow);
    }
    .tab {
      padding: 9px 14px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-3);
      border-radius: 10px;
      border: 1px solid transparent;
      transition: all .2s ease;
      cursor: pointer;
      user-select: none;
    }
    .tab:hover { color: var(--text-2); }
    .tab.active {
      color: var(--text);
      background: linear-gradient(155deg, rgba(124,139,255,.25), rgba(86,214,255,.2));
      border-color: rgba(255,255,255,.22);
      box-shadow: 0 8px 20px rgba(124,139,255,.25);
    }

    .view { display:none; }
    .view.active { display:block; }

    .kanban { display:grid; grid-template-columns: repeat(5,1fr); gap: 13px; min-height: 420px; }
    .kanban-col {
      border: 1px solid rgba(255,255,255,0.08);
      background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
      border-radius: 14px;
      padding: 8px;
      box-shadow: var(--card-shadow);
    }
    .col-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 10px 12px;
      margin-bottom: 10px;
      font-size: 11px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .9px;
      color: var(--text-2);
      background: rgba(8, 12, 21, 0.72);
      border-color: rgba(255,255,255,.1);
    }
    .col-count {
      font-size: 10px;
      font-weight: 700;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.08);
      color: var(--text-3);
      border: 1px solid rgba(255,255,255,.1);
    }
    .col-dot { width:8px; height:8px; border-radius:50%; margin-right:8px; display:inline-block; }
    .col-cards { display:flex; flex-direction:column; gap: 9px; }

    .k-card {
      padding: 14px 15px;
      transition: all .2s ease;
      background: linear-gradient(155deg, rgba(255,255,255,.08), rgba(255,255,255,.03));
      border-color: rgba(255,255,255,.12);
    }
    .k-card:hover { transform: translateY(-2px); box-shadow: var(--lift-shadow); }
    .k-title { font-size: 13px; font-weight: 600; line-height: 1.38; margin-bottom: 9px; }
    .k-meta { display:flex; align-items:center; gap:7px; flex-wrap:wrap; }
    .k-tag {
      font-size: 9px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: .45px;
      padding: 3px 8px;
      border-radius: 7px;
      border: 1px solid transparent;
    }
    .k-project { font-size: 10px; color: var(--text-3); }
    .k-notes { font-size: 10px; color: var(--text-3); margin-top: 8px; line-height: 1.42; }
    .k-date { font-size: 9px; color: var(--text-3); font-family: ui-monospace, SFMono-Regular, Menlo, monospace; margin-top: 8px; }

    .tag-critical { background: rgba(251,113,133,.12); color: var(--red); border-color: rgba(251,113,133,.28); }
    .tag-high { background: rgba(251,191,36,.12); color: var(--amber); border-color: rgba(251,191,36,.28); }
    .tag-medium { background: rgba(124,139,255,.12); color: var(--accent); border-color: rgba(124,139,255,.28); }
    .tag-low { background: rgba(255,255,255,.08); color: var(--text-3); border-color: rgba(255,255,255,.14); }

    .card-critical { border-color: rgba(251,113,133,.42); box-shadow: 0 0 0 1px rgba(251,113,133,.2) inset, 0 14px 28px rgba(251,113,133,.12); }
    .card-high { border-color: rgba(251,191,36,.3); }

    .list-section { margin-bottom: 24px; }
    .list-header { display:flex; align-items:center; gap:8px; font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:1.2px; color:var(--text-2); margin-bottom:10px; }
    .list-dot { width:7px; height:7px; border-radius:50%; }
    .list-cards { display:flex; flex-direction:column; gap: 8px; }

    .l-card {
      padding: 14px 17px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      transition: all .2s ease;
      border-color: rgba(255,255,255,.11);
      background: linear-gradient(155deg, rgba(255,255,255,.07), rgba(255,255,255,.03));
    }
    .l-card:hover { transform: translateY(-1px); box-shadow: var(--lift-shadow); }
    .l-left { display:flex; align-items:center; gap:10px; flex:1; min-width:0; }
    .l-dot { width:8px; height:8px; border-radius:50%; flex-shrink:0; }
    .l-title { font-size:13px; font-weight:600; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .l-right { display:flex; align-items:center; gap:10px; flex-shrink:0; }
    .l-done .l-title { text-decoration: line-through; color: var(--text-2); text-decoration-color: rgba(255,255,255,.2); }
    .l-check { color: var(--green); font-size: 12px; }

    .footer {
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-top: 34px;
      font-size: 10px;
      color: var(--text-3);
      letter-spacing: .7px;
      font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
      opacity: .9;
    }

    @media (max-width: 1200px) { .kanban { grid-template-columns: repeat(3, 1fr); } }
    @media (max-width: 860px) {
      .header { flex-direction: column; align-items: flex-start; gap: 12px; }
      .h-right { flex-wrap: wrap; }
      .stats { grid-template-columns: repeat(2,1fr); }
      .footer { flex-direction: column; align-items: flex-start; gap: 4px; }
    }
    @media (max-width: 720px) { .kanban { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <div class="ambient">
    <div class="blob b1"></div>
    <div class="blob b2"></div>
    <div class="blob b3"></div>
  </div>

  <div class="container">
    <header class="header">
      <div class="h-left">
        <div class="h-icon">üê¢</div>
        <div>
          <div class="h-title">Mission Control</div>
          <div class="h-sub">Turtok Command Center</div>
        </div>
      </div>
      <div class="h-right">
        <button class="btn" id="refresh-btn">‚ü≥ Refresh</button>
        <div class="clock" id="clock"></div>
        <div class="status-pill"><div class="s-dot"></div><span id="agent-status">Online</span></div>
      </div>
    </header>

    <div class="glass cur" id="cur-banner">
      <span class="cur-label">Aktuell</span>
      <span class="cur-text" id="cur-task"></span>
    </div>

    <div class="stats">
      <div class="glass stat"><div class="sv" style="color:var(--text)" id="s-total">0</div><div class="sl">Gesamt</div></div>
      <div class="glass stat"><div class="sv" style="color:var(--text-2)" id="s-backlog">0</div><div class="sl">Backlog</div></div>
      <div class="glass stat"><div class="sv" style="color:var(--amber)" id="s-todo">0</div><div class="sl">Todo</div></div>
      <div class="glass stat"><div class="sv" style="color:var(--accent)" id="s-prog">0</div><div class="sl">In Arbeit</div></div>
      <div class="glass stat"><div class="sv" style="color:var(--green)" id="s-done">0</div><div class="sl">Erledigt</div></div>
    </div>

    <div class="prog">
      <div class="prog-h"><span>Fortschritt</span><span id="prog-pct">0%</span></div>
      <div class="prog-track"><div class="prog-fill" id="prog-bar" style="width:0%"></div></div>
    </div>

    <div class="tabs">
      <div class="tab active" data-view="kanban">Kanban</div>
      <div class="tab" data-view="list">Liste</div>
      <div class="tab" data-view="eodlog">üìã EOD Log</div>
      <div style="flex:1"></div>
      <div class="tab filter-tab" data-filter="all" style="font-size:.75rem;padding:6px 14px;">Alle</div>
      <div class="tab filter-tab" data-filter="Dennis" style="font-size:.75rem;padding:6px 14px;">üë§ Dennis</div>
    </div>

    <div class="view active" id="view-kanban">
      <div class="kanban">
        <div class="kanban-col">
          <div class="col-header glass glass-sm"><div><span class="col-dot" style="background:var(--text-3)"></span>Backlog</div><span class="col-count" id="c-backlog">0</span></div>
          <div class="col-cards" id="col-backlog"></div>
        </div>
        <div class="kanban-col">
          <div class="col-header glass glass-sm"><div><span class="col-dot" style="background:var(--amber)"></span>Todo</div><span class="col-count" id="c-todo">0</span></div>
          <div class="col-cards" id="col-todo"></div>
        </div>
        <div class="kanban-col">
          <div class="col-header glass glass-sm"><div><span class="col-dot" style="background:var(--accent)"></span>In Arbeit</div><span class="col-count" id="c-progress">0</span></div>
          <div class="col-cards" id="col-progress"></div>
        </div>
        <div class="kanban-col">
          <div class="col-header glass glass-sm"><div><span class="col-dot" style="background:var(--blue)"></span>Review</div><span class="col-count" id="c-review">0</span></div>
          <div class="col-cards" id="col-review"></div>
        </div>
        <div class="kanban-col">
          <div class="col-header glass glass-sm"><div><span class="col-dot" style="background:var(--green)"></span>Erledigt</div><span class="col-count" id="c-done">0</span></div>
          <div class="col-cards" id="col-done"></div>
        </div>
      </div>
    </div>

    <div class="view" id="view-list">
      <div id="list-content"></div>
    </div>

    <div class="view" id="view-eodlog">
      <div id="eodlog-content"></div>
    </div>

    <footer class="footer">
      <span>turtok v3 ¬∑ mission control ¬∑ modern ui</span>
      <span id="last-sync">last sync: --:--:--</span>
    </footer>
  </div>

  <script>
    const pOrder = { critical:0, high:1, medium:2, low:3 };
    const pLabels = { critical:'Kritisch', high:'Hoch', medium:'Mittel', low:'Niedrig' };
    const columns = ['backlog','todo','in-progress','review','done'];
    const colLabels = { backlog:'Backlog', todo:'Todo', 'in-progress':'In Arbeit', review:'Review', done:'Erledigt' };
    const colDotStyle = {
      backlog: 'var(--text-3)', todo: 'var(--amber)',
      'in-progress': 'var(--accent)', review: 'var(--blue)', done: 'var(--green)'
    };

    function updateClock() {
      document.getElementById('clock').textContent = new Date().toLocaleString('de-DE', {
        weekday:'short', day:'2-digit', month:'short', hour:'2-digit', minute:'2-digit', second:'2-digit'
      });
    }

    function stampSync() {
      document.getElementById('last-sync').textContent = 'last sync: ' + new Date().toLocaleTimeString('de-DE');
    }

    function cardGlow(p) {
      if (p === 'critical') return 'card-critical';
      if (p === 'high') return 'card-high';
      return '';
    }

    function renderKanbanCard(t, projects) {
      const emoji = projects?.find(p => p.name === t.project)?.emoji || 'üìã';
      const isDone = t.status === 'done';
      return `
        <div class="glass glass-sm k-card ${cardGlow(t.priority)}">
          <div class="k-title" style="${isDone ? 'text-decoration:line-through;color:var(--text-2);text-decoration-color:rgba(255,255,255,0.15)' : ''}">${t.title}</div>
          <div class="k-meta">
            <span class="k-tag tag-${t.priority}">${pLabels[t.priority]}</span>
            <span class="k-project">${emoji} ${t.project}</span>
          </div>
          ${t.assignee ? `<span class="k-tag" style="background:rgba(99,102,241,.25);color:#a5b4fc;">üë§ ${t.assignee}</span>` : ''}
          ${t.notes ? `<div class="k-notes">${t.notes}</div>` : ''}
          ${t.completed ? `<div class="k-date">‚úì ${t.completed}</div>` : ''}
        </div>`;
    }

    function renderListView(tasks, projects) {
      const groups = {};
      columns.forEach(c => groups[c] = []);
      tasks.forEach(t => {
        const col = columns.includes(t.status) ? t.status : 'backlog';
        groups[col].push(t);
      });
      Object.values(groups).forEach(g => g.sort((a,b) => (pOrder[a.priority]??9) - (pOrder[b.priority]??9)));
      groups.done.sort((a,b) => (b.completed||'').localeCompare(a.completed||''));

      let html = '';
      columns.forEach(col => {
        if (groups[col].length === 0) return;
        const isDone = col === 'done';
        html += `<div class="list-section">
          <div class="list-header"><div class="list-dot" style="background:${colDotStyle[col]}"></div>${colLabels[col]} (${groups[col].length})</div>
          <div class="list-cards">`;
        groups[col].forEach(t => {
          const emoji = projects?.find(p => p.name === t.project)?.emoji || 'üìã';
          html += `<div class="glass glass-sm l-card ${isDone ? 'l-done' : ''} ${cardGlow(t.priority)}">
            <div class="l-left">
              ${isDone ? '<span class="l-check">‚úì</span>' : `<div class="l-dot" style="background:${colDotStyle[col]}"></div>`}
              <span class="l-title">${t.title}</span>
            </div>
            <div class="l-right">
              <span class="k-project">${emoji} ${t.project}</span>
              <span class="k-tag tag-${t.priority}">${pLabels[t.priority]}</span>
              ${t.completed ? `<span class="k-date">‚úì ${t.completed}</span>` : ''}
            </div>
          </div>`;
        });
        html += '</div></div>';
      });
      return html;
    }

    function renderEodLog(entries) {
      if (!entries || entries.length === 0) {
        return '<div style="padding:60px;text-align:center;color:var(--text-3);font-size:.95rem;">Noch keine EOD-Eintr√§ge vorhanden.</div>';
      }
      return [...entries].reverse().map(entry => `
        <div class="glass" style="margin-bottom:20px;padding:28px 32px;">
          <div style="font-size:1.05rem;font-weight:700;color:var(--accent);margin-bottom:20px;display:flex;align-items:center;gap:10px;letter-spacing:.01em;">
            üìÖ ${entry.date}
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:24px;">
            <div>
              <div style="font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--green);margin-bottom:12px;">‚úÖ A) Heute umgesetzt</div>
              <ul style="list-style:none;display:flex;flex-direction:column;gap:8px;">
                ${(entry.done||[]).map(item => `
                  <li style="display:flex;gap:10px;align-items:flex-start;color:var(--text-2);font-size:.875rem;line-height:1.5;">
                    <span style="color:var(--green);flex-shrink:0;margin-top:3px;">‚ñ∏</span>
                    <span>${item}</span>
                  </li>`).join('')}
              </ul>
            </div>
            <div>
              <div style="font-size:.7rem;font-weight:700;text-transform:uppercase;letter-spacing:.1em;color:var(--accent-2);margin-bottom:12px;">üí° B) Gelernt / Verbessert</div>
              <ul style="list-style:none;display:flex;flex-direction:column;gap:8px;">
                ${(entry.learned||[]).map(item => `
                  <li style="display:flex;gap:10px;align-items:flex-start;color:var(--text-2);font-size:.875rem;line-height:1.5;">
                    <span style="color:var(--accent-2);flex-shrink:0;margin-top:3px;">‚ñ∏</span>
                    <span>${item}</span>
                  </li>`).join('')}
              </ul>
            </div>
          </div>
        </div>`).join('');
    }

    let data = null;
    let activeFilter = 'all';

    document.querySelectorAll('.filter-tab').forEach(ft => {
      ft.addEventListener('click', () => {
        document.querySelectorAll('.filter-tab').forEach(f => f.classList.remove('active'));
        ft.classList.add('active');
        activeFilter = ft.dataset.filter;
        render();
      });
    });

    async function loadData() {
      try {
        data = await (await fetch('data.json?t=' + Date.now())).json();
        render();
        stampSync();
      } catch (e) {
        console.error(e);
      }
    }

    function render() {
      if (!data) return;
      document.getElementById('cur-task').textContent = data.agent.currentTask;

      const tasks = activeFilter === 'all' ? data.tasks : data.tasks.filter(t => t.assignee === activeFilter);
      const byStatus = {};
      columns.forEach(c => byStatus[c] = []);
      tasks.forEach(t => {
        const col = columns.includes(t.status) ? t.status : 'backlog';
        byStatus[col].push(t);
      });

      document.getElementById('s-total').textContent = tasks.length;
      document.getElementById('s-backlog').textContent = byStatus.backlog.length;
      document.getElementById('s-todo').textContent = byStatus.todo.length;
      document.getElementById('s-prog').textContent = byStatus['in-progress'].length;
      document.getElementById('s-done').textContent = byStatus.done.length;

      const doneCount = byStatus.done.length;
      const pct = tasks.length ? Math.round((doneCount / tasks.length) * 100) : 0;
      document.getElementById('prog-pct').textContent = pct + '%';
      document.getElementById('prog-bar').style.width = pct + '%';

      columns.forEach(col => {
        const sorted = [...byStatus[col]].sort((a,b) => (pOrder[a.priority]??9) - (pOrder[b.priority]??9));
        if (col === 'done') sorted.sort((a,b) => (b.completed||'').localeCompare(a.completed||''));

        const colEl = document.getElementById('col-' + (col === 'in-progress' ? 'progress' : col));
        const countEl = document.getElementById('c-' + (col === 'in-progress' ? 'progress' : col));
        if (colEl) colEl.innerHTML = sorted.map(t => renderKanbanCard(t, data.projects)).join('');
        if (countEl) countEl.textContent = sorted.length;
      });

      document.getElementById('list-content').innerHTML = renderListView(tasks, data.projects);
      if (data.eodLog) {
        document.getElementById('eodlog-content').innerHTML = renderEodLog(data.eodLog);
      }
    }

    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        tab.classList.add('active');
        document.getElementById('view-' + tab.dataset.view).classList.add('active');
      });
    });

    document.getElementById('refresh-btn').addEventListener('click', loadData);

    updateClock();
    setInterval(updateClock, 1000);
    loadData();
    setInterval(loadData, 30000);
  </script>
</body>
</html>